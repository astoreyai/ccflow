"""
ccflow - Claude Code CLI â†” SDK Middleware

Production middleware bridging Claude Code CLI with SDK-like Python interfaces.
Enables subscription-based usage with TOON token optimization.

Example:
    >>> from ccflow import query, CLIAgentOptions
    >>> async for msg in query("Analyze this code", CLIAgentOptions(model="sonnet")):
    ...     print(msg.content, end="")
"""

from ccflow.api import batch_query, query
from ccflow.api_client import (
    APIClient,
    APIClientConfig,
    APIClientError,
    APINotAvailableError,
    APIRateLimitError,
    APIResponse,
    FallbackConfig,
    FallbackExecutor,
    get_api_client,
    get_fallback_executor,
    reset_api_client,
    reset_fallback_executor,
)
from ccflow.events import (
    CostIncurredEvent,
    CostTracker,
    Event,
    EventEmitter,
    EventType,
    LoggingHandler,
    MetricsHandler,
    SessionClosedEvent,
    SessionCreatedEvent,
    SessionDeletedEvent,
    SessionErrorEvent,
    SessionEvent,
    SessionLoadedEvent,
    SessionPersistedEvent,
    SessionResumedEvent,
    ThinkingReceivedEvent,
    TokensUsedEvent,
    ToolCalledEvent,
    ToolResultEvent,
    TurnCompletedEvent,
    TurnStartedEvent,
    get_emitter,
    reset_emitter,
)
from ccflow.exceptions import (
    CCFlowError,
    CLIAuthenticationError,
    CLIExecutionError,
    CLINotFoundError,
    CLITimeoutError,
    ParseError,
    PermissionDeniedError,
    SessionNotFoundError,
    SessionStoreError,
    ToonEncodingError,
)
from ccflow.manager import SessionManager, get_manager, init_manager
from ccflow.metrics_handlers import (
    PrometheusEventHandler,
    setup_metrics,
    start_metrics_server,
)
from ccflow.parser import (
    collect_text,
    collect_thinking,
    extract_thinking_from_assistant,
    extract_thinking_tokens,
)
from ccflow.pool import (
    PoolConfig,
    PoolStats,
    PoolTask,
    ProcessPool,
    StreamingPool,
    StreamingTask,
    TaskStatus,
    get_pool,
    get_streaming_pool,
    reset_pools,
)
from ccflow.pricing import (
    ModelPricing,
    ModelTier,
    UsageStats,
    calculate_cost,
    extract_model_from_events,
    extract_usage_from_events,
    get_pricing,
    get_usage_tracker,
    reset_usage_tracker,
    track_usage,
)
from ccflow.project import Project
from ccflow.rate_limiting import (
    CombinedLimiter,
    ConcurrencyLimiter,
    ConcurrencyLimitExceededError,
    RateLimiterStats,
    RateLimitExceededError,
    RetryHandler,
    SlidingWindowRateLimiter,
    TokenBucketRateLimiter,
    get_limiter,
    reset_limiter,
)
from ccflow.reliability import (
    CircuitBreaker,
    CircuitBreakerConfig,
    CircuitBreakerError,
    CircuitBreakerStats,
    CircuitState,
    HealthChecker,
    HealthStatus,
    RetryConfig,
    RetryExhaustedError,
    RetryStats,
    bind_correlation_id,
    calculate_delay,
    get_cli_circuit_breaker,
    get_correlation_id,
    get_health_checker,
    reset_cli_circuit_breaker,
    reset_health_checker,
    retry_with_backoff,
    set_correlation_id,
    with_retry,
)
from ccflow.session import Session, load_session, resume_session
from ccflow.store import (
    BaseSessionStore,
    SessionFilter,
    SessionMetadata,
    SessionState,
    SessionStatus,
    SessionStore,
)
from ccflow.stores import (
    MemorySessionStore,
    SQLiteProjectStore,
    SQLiteSessionStore,
    SQLiteTraceStore,
)
from ccflow.trace_store import (
    BaseProjectStore,
    BaseTraceStore,
    ProjectStore,
    TraceStore,
)
from ccflow.tracing import TracingSession, create_tracing_session
from ccflow.types import (
    AssistantMessage,
    CLIAgentOptions,
    HookMessage,
    InitMessage,
    MCPServerConfig,
    Message,
    PermissionMode,
    ProjectData,
    ProjectFilter,
    QueryResult,
    ResultMessage,
    SessionStats,
    StopMessage,
    TextMessage,
    ThinkingMessage,
    ToolResultMessage,
    ToolUseMessage,
    ToonConfig,
    TraceData,
    TraceFilter,
    TraceStatus,
    UnknownMessage,
    UnknownSystemMessage,
    UserMessage,
)

__version__ = "0.1.0"
__all__ = [
    # API Fallback
    "APIClient",
    "APIClientConfig",
    "APIClientError",
    "APINotAvailableError",
    "APIRateLimitError",
    "APIResponse",
    "AssistantMessage",
    # Store base classes
    "BaseProjectStore",
    "BaseSessionStore",
    "BaseTraceStore",
    # Exceptions
    "CCFlowError",
    # Configuration
    "CLIAgentOptions",
    "CLIAuthenticationError",
    "CLIExecutionError",
    "CLINotFoundError",
    "CLITimeoutError",
    # Reliability (Circuit Breaker, Retry, Health)
    "CircuitBreaker",
    "CircuitBreakerConfig",
    "CircuitBreakerError",
    "CircuitBreakerStats",
    "CircuitState",
    "CombinedLimiter",
    "ConcurrencyLimitExceededError",
    "ConcurrencyLimiter",
    "CostIncurredEvent",
    "CostTracker",
    # Events
    "Event",
    "EventEmitter",
    "EventType",
    "FallbackConfig",
    "FallbackExecutor",
    "HealthChecker",
    "HealthStatus",
    "HookMessage",
    "InitMessage",
    "LoggingHandler",
    "MCPServerConfig",
    "MemorySessionStore",
    # Message types
    "Message",
    "MetricsHandler",
    # Pricing and Usage
    "ModelPricing",
    "ModelTier",
    "ParseError",
    "PermissionDeniedError",
    "PermissionMode",
    "PoolConfig",
    "PoolStats",
    "PoolTask",
    # Process Pool
    "ProcessPool",
    # Project and Trace system
    "Project",
    "ProjectData",
    "ProjectFilter",
    "ProjectStore",
    # Prometheus Metrics
    "PrometheusEventHandler",
    # Results
    "QueryResult",
    "RateLimitExceededError",
    "RateLimiterStats",
    "ResultMessage",
    "RetryConfig",
    "RetryExhaustedError",
    "RetryHandler",
    "RetryStats",
    "SQLiteProjectStore",
    "SQLiteSessionStore",
    "SQLiteTraceStore",
    "Session",
    "SessionClosedEvent",
    "SessionCreatedEvent",
    "SessionDeletedEvent",
    "SessionErrorEvent",
    "SessionEvent",
    "SessionFilter",
    "SessionLoadedEvent",
    # Session Management
    "SessionManager",
    "SessionMetadata",
    "SessionNotFoundError",
    "SessionPersistedEvent",
    "SessionResumedEvent",
    "SessionState",
    "SessionStats",
    "SessionStatus",
    # Session Persistence
    "SessionStore",
    "SessionStoreError",
    "SlidingWindowRateLimiter",
    "StopMessage",
    "StreamingPool",
    "StreamingTask",
    "TaskStatus",
    "TextMessage",
    "ThinkingMessage",
    "ThinkingReceivedEvent",
    # Rate Limiting
    "TokenBucketRateLimiter",
    "TokensUsedEvent",
    "ToolCalledEvent",
    "ToolResultEvent",
    "ToolResultMessage",
    "ToolUseMessage",
    "ToonConfig",
    "ToonEncodingError",
    # Trace system
    "TraceData",
    "TraceFilter",
    "TraceStatus",
    "TraceStore",
    "TracingSession",
    "TurnCompletedEvent",
    "TurnStartedEvent",
    "UnknownMessage",
    "UnknownSystemMessage",
    "UsageStats",
    "UserMessage",
    "batch_query",
    "bind_correlation_id",
    "calculate_cost",
    "calculate_delay",
    # Parser helpers
    "collect_text",
    "collect_thinking",
    "create_tracing_session",
    "extract_model_from_events",
    "extract_thinking_from_assistant",
    "extract_thinking_tokens",
    "extract_usage_from_events",
    "get_api_client",
    "get_cli_circuit_breaker",
    # Correlation IDs
    "get_correlation_id",
    "get_emitter",
    "get_fallback_executor",
    "get_health_checker",
    "get_limiter",
    "get_manager",
    "get_pool",
    "get_pricing",
    "get_streaming_pool",
    "get_usage_tracker",
    "init_manager",
    "load_session",
    # Core API
    "query",
    "reset_api_client",
    "reset_cli_circuit_breaker",
    "reset_emitter",
    "reset_fallback_executor",
    "reset_health_checker",
    "reset_limiter",
    "reset_pools",
    "reset_usage_tracker",
    "resume_session",
    "retry_with_backoff",
    "set_correlation_id",
    "setup_metrics",
    "start_metrics_server",
    "track_usage",
    "with_retry",
]
